# Copyleft 2023, pEp Foundation
# This file is part of pEpEngineSequoiaBackend
# This file may be used under the terms of the GNU General Public License version 3
# see COPYING

# Build config defaults
# To get a debug build define DEBUG in local.mak
#DEBUG=debug
CARGO=cargo

# Build config overrides
!IF EXISTS(local.mak)
!include .\local.mak
!ENDIF

# Define build target and flags
# --target=x86_64-win7-windows-msvc
!IFDEF DEBUG
TARGET=target\debug\pep_engine_sequoia_backend.dll
TARGET_DIR=target\debug
CARGOFLAGS=
!ELSE
TARGET=target\release\pep_engine_sequoia_backend.dll
TARGET_DIR=target\release
CARGOFLAGS=--release
!ENDIF

build:
	$(CARGO) rustc $(CARGOFLAGS) -- -L$(OUTPUT)
	@echo Built $(TARGET)
	DEL  $(OUTPUT)\pep_engine_sequoia_backend*
	XCOPY $(TARGET_DIR)\pep_engine_sequoia_backend* $(OUTPUT) /q

clean:
	RD /s /q target
